/* frontend/src/pages/SurveyBuildPage.module.css */
/* ----- START OF COMPLETE MODIFIED FILE (v3.7 - Aggressive Vertical Expansion for Heatmap) ----- */

/* ... (all previous CSS from v3.6 remains the same up to .modalContentWrapper) ... */
.surveyBuildPage {
    display: flex;
    flex-direction: column;
    max-width: 100%;
    margin: 0 auto;
    position: relative; 
    background-color: var(--page-background, #e9ecef);
}

.surveyBuildPageInner {
    padding: 20px;
    padding-top: 80px; 
}


.surveyHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    margin-bottom: 25px;
    position: sticky;
    top: 60px; 
    background-color: var(--background-color, #ffffff);
    z-index: 1000; 
    border-radius: var(--border-radius-lg, 8px);
    box-shadow: var(--shadow-md, 0 4px 10px rgba(0,0,0,0.07));
    margin-left: 0;
    margin-right: 0;
}

.surveyTitleInput {
    font-size: 1.6em;
    font-weight: 600;
    border: 1px solid var(--input-border-subtle, #ced4da);
    padding: 10px 15px;
    border-radius: var(--border-radius-md);
    background-color: var(--input-bg, #fff);
    color: var(--text-color-strong);
    flex-grow: 1;
    margin-right: 25px;
}
.surveyTitleInput:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.2rem var(--primary-color-alpha);
    background-color: var(--background-color-light);
}

.headerActions {
    display: flex;
    gap: 12px;
    flex-shrink: 0;
}

.mainContentWrapper {
  display: flex;
  flex-direction: row;
  gap: 25px;
}

.leftColumnWithPanelSpace {
  flex: 2;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.leftColumnFullWidth {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.rightColumnSizer {
  flex: 1;
  min-width: 400px;
  max-width: 650px;
}


.panelSection {
  background-color: var(--background-color-light, #ffffff);
  border: 1px solid var(--border-color, #e0e0e0);
  border-radius: var(--border-radius-lg, 8px);
  padding: 25px;
  box-shadow: var(--shadow-md, 0 4px 10px rgba(0,0,0,0.08));
  display: flex;
  flex-direction: column;
  flex-grow: 1;
}


.questionListHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0;
  padding: 20px 25px;
  background-color: var(--background-accent, #f8f9fa);
  border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
  border-bottom: 1px solid var(--border-color, #e0e0e0);
}
.questionListHeader h2 {
    margin: 0;
    font-size: 1.5em;
    color: var(--text-color-strong);
}

.questionsContainer {
  background-color: var(--background-color, #fff);
  padding: 25px;
  border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
  box-shadow: var(--shadow-md, 0 4px 10px rgba(0,0,0,0.07));
  flex-grow: 1;
  border: 1px solid var(--border-color, #e0e0e0);
  border-top: none;
}

.noQuestionsMessage {
    font-style: italic;
    color: var(--text-muted);
    text-align: center;
    padding: 40px 20px;
    background-color: transparent;
    border-radius: var(--border-radius);
    margin-top: 0;
}

.modalBackdrop {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.65);
  z-index: 1040;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
  box-sizing: border-box;
}

.modalContentWrapper {
  max-width: 95%;
  max-height: 90vh; 
  display: flex;
  flex-direction: column;
  overflow: hidden; 
  border-radius: var(--border-radius-xl, 12px);
  box-shadow: var(--shadow-xl, 0 10px 25px rgba(0,0,0,0.15), 0 5px 10px rgba(0,0,0,0.1));
}

.heatmapAreaModalContent {
    background-color: var(--background-color-light, #fff);
    border-radius: var(--border-radius-xl, 12px);
    display: flex;
    flex-direction: column;
    width: 80vw; 
    max-width: 1200px; 
    height: 85vh; /* MODIFIED: Let's try making this more flexible or ensuring children can use it */
    /* If height is fixed, children need to be able to expand into it. */
    /* max-height: calc(90vh - 40px); -> This is good, height: 85vh might be too rigid if padding/borders add up */
    /* Let's try removing fixed height here and let content define it up to max-height of wrapper */
    /* height: auto; */ /* Let's test this later if needed */
    overflow: hidden; 
    color: var(--text-color);
}

.modalHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 25px;
    border-bottom: 1px solid var(--border-color-light, #dee2e6);
    background-color: var(--background-accent, #f8f9fa);
    border-radius: var(--border-radius-xl, 12px) var(--border-radius-xl, 12px) 0 0;
    flex-shrink: 0; 
}

.modalHeader h3 { margin: 0; font-size: 1.3em; font-weight: 600; color: var(--text-color-strong); }

.modalCloseButton {
    background: none; border: none; font-size: 1.8em; font-weight: bold;
    color: var(--text-muted); cursor: pointer; padding: 0 5px; line-height: 1;
}
.modalCloseButton:hover { color: var(--text-color-strong); }

.heatmapAreaModalBody {
    display: flex;
    flex-direction: row; 
    flex-grow: 1; /* Takes up remaining vertical space in modalContent */
    padding: 20px 25px; /* Keep padding */
    gap: 25px;
    overflow: hidden; /* Children will scroll if needed, not this body */
    min-height: 0; /* Essential for flex children to allow them to shrink or grow properly */
}

.heatmapAreaListPanel {
    flex: 0 0 300px; 
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding-right: 15px; 
    border-right: 1px solid var(--border-color-light, #dee2e6);
    overflow-y: auto; 
    min-height: 0; /* Good for scrollable flex children */
    /* max-height: 100%; */ /* Ensure it doesn't overflow its flex parent if content is huge */
}
.heatmapAreaListPanel h4 { margin-top: 0; margin-bottom: 10px; font-size: 1.1em; color: var(--text-color-strong); }
.heatmapDefinedAreasList { list-style: none; padding: 0; margin: 0; flex-grow: 1; }
.heatmapDefinedAreasList li {
    padding: 10px 12px; border: 1px solid var(--border-color-light, #dee2e6);
    border-radius: var(--border-radius-md); margin-bottom: 8px; cursor: pointer;
    transition: background-color 0.2s, border-color 0.2s; font-size: 0.95em;
}
.heatmapDefinedAreasList li:hover { background-color: var(--background-accent-hover, #e9ecef); border-color: var(--border-color, #ced4da); }
.selectedAreaItem { 
    background-color: var(--primary-color-light, #cfe2ff) !important;
    border-color: var(--primary-color, #0d6efd) !important;
    font-weight: 500; color: var(--primary-color-dark, #0a58ca);
}

.heatmapAreaDrawingPanel {
    flex-grow: 1; 
    display: flex;
    flex-direction: column;
    gap: 15px; 
    overflow: hidden; 
    min-width: 0;
    min-height: 0; /* MODIFIED: Add min-height: 0 for better flex behavior */
    /* This panel needs to be able to take up all available vertical space in its parent (.heatmapAreaModalBody) */
}

.modalInstructions { 
    font-size: 0.9em; color: var(--text-muted); margin-top: 0; padding: 8px 12px;
    background-color: var(--background-accent, #f8f9fa); border-radius: var(--border-radius-sm);
    flex-shrink: 0; 
}

.heatmapImageContainer {
    flex-grow: 1; /* This is key for vertical expansion */
    display: flex; 
    justify-content: center;
    align-items: center;
    background-color: var(--background-color-darker, #dddddd); 
    border-radius: var(--border-radius-md);
    border: 1px solid var(--border-color, #ced4da);
    min-height: 300px; /* MODIFIED: Increased fallback min-height, adjust as needed */
                     /* This ensures it has a decent size even if flex calculations are tricky */
    overflow: hidden; 
    position: relative; /* Keep for absolutely positioned children like labels */
}

.heatmapSelectableImage {
    display: block; 
    max-width: 100%;
    max-height: 100%; /* This will make the image fit within the container bounds */
    object-fit: contain; 
    user-select: none; 
    cursor: crosshair; 
}

.heatmapAreaLabelOnImage {
    position: absolute; bottom: 2px; left: 2px; background-color: rgba(0, 0, 0, 0.6);
    color: white; padding: 2px 5px; font-size: 0.75em; border-radius: var(--border-radius-sm);
    pointer-events: none;
}

.heatmapAreaControls {
    display: flex; align-items: center; gap: 10px; padding-top: 10px; 
    border-top: 1px solid var(--border-color-light, #dee2e6);
    flex-shrink: 0; 
}
.heatmapAreaControls .formControl { flex-grow: 1; }

.heatmapCoordsDisplay {
    font-size: 0.8em; color: var(--text-muted); text-align: right;
    flex-shrink: 0; padding-top: 5px; 
}

.modalFooter { 
    display: flex; justify-content: flex-end; align-items: center;
    padding: 15px 25px; border-top: 1px solid var(--border-color-light, #dee2e6);
    background-color: var(--background-accent, #f8f9fa);
    border-radius: 0 0 var(--border-radius-xl, 12px) var(--border-radius-xl, 12px); 
    gap: 10px; flex-shrink: 0; 
}

.formControl {
    padding: 0.5rem 0.75rem; font-size: 0.95rem; line-height: 1.5;
    color: var(--input-color, #212529); background-color: var(--input-bg, #fff);
    background-clip: padding-box; border: 1px solid var(--input-border-color, #ced4da);
    border-radius: var(--border-radius-md, 0.375rem);
    transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
}
.formControl:focus {
    border-color: var(--primary-color-light); outline: 0;
    box-shadow: 0 0 0 0.2rem var(--primary-color-alpha);
}

.textMuted { color: var(--text-muted, #6c757d); }
.invalidFeedback { width: 100%; margin-top: .25rem; font-size: .875em; color: var(--danger-color, #dc3545); }

/* Media Queries for Responsiveness */
@media (max-width: 1024px) {
  .mainContentWrapper { flex-direction: column; }
  .rightColumnSizer { min-width: 100%; max-width: 100%; flex-basis: auto; }
  .leftColumnWithPanelSpace { flex-basis: auto; }

  .heatmapAreaModalContent { 
    width: 90vw;
    /* height: auto; Let content define height up to max-height */
    min-height: 75vh; /* MODIFIED: Ensure decent height on tablets */
  }
  .heatmapAreaModalBody { 
    flex-direction: column; 
    overflow-y: auto; /* Allow body to scroll if content overflows */
    /* min-height: 0; is already set which is good */
  }
  .heatmapAreaListPanel { 
    flex: 0 0 auto; 
    max-height: 200px; 
    border-right: none;
    border-bottom: 1px solid var(--border-color-light, #dee2e6);
    padding-right: 0; margin-bottom: 15px;
  }
  .heatmapAreaDrawingPanel { 
    min-height: 350px; /* MODIFIED: Ensure drawing panel has good space */
    flex-grow: 1; /* Ensure it tries to take available space */
  }
  .heatmapImageContainer {
     min-height: 250px; /* MODIFIED: Ensure image container has space */
     /* Consider increasing this more if needed for tablet */
  }
}

@media (max-width: 768px) {
  .surveyBuildPageInner { padding: 15px; padding-top: 70px; }
  .surveyHeader { flex-direction: column; align-items: flex-start; gap: 15px; padding: 15px; top: 50px; border-radius: var(--border-radius-md); }
  .surveyTitleInput { width: 100%; margin-right: 0; font-size: 1.4em; padding: 10px; }
  .headerActions { width: 100%; justify-content: space-between; flex-wrap: wrap; }
  .headerActions .button { flex-grow: 1; min-width: 110px; font-size: 0.85em; margin-bottom: 8px; }
  .questionListHeader { padding: 15px 20px; }
  .questionsContainer { padding: 20px; }

  .heatmapAreaModalContent { 
    width: 95vw; height: auto; max-height: 85vh; 
    min-height: 80vh; /* MODIFIED: Ensure good height on mobile */
  }
  .heatmapAreaModalBody { padding: 15px; gap: 15px; }
  .heatmapAreaControls { flex-direction: column; align-items: stretch; }
  .heatmapAreaListPanel { max-height: 150px; }
  .heatmapAreaDrawingPanel { min-height: 300px; /* Ensure drawing panel has space */ } 
  .heatmapImageContainer { min-height: 250px; /* MODIFIED: Increased min-height for mobile */ }
}
/* ----- END OF COMPLETE MODIFIED FILE (v3.7) ----- */